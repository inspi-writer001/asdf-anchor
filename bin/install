#!/usr/bin/env bash
set -euo pipefail

current_script_path=${BASH_SOURCE[0]}
plugin_dir=$(dirname "$(dirname "$current_script_path")")
source "${plugin_dir}/lib/utils.bash"

version="${1:-${ASDF_INSTALL_VERSION:-}}"
install_path="${2:-${ASDF_INSTALL_PATH:-}}"

if [ -z "$version" ] || [ -z "$install_path" ]; then
  echo "Usage: $0 <version> <install-path>"
  exit 1
fi

platform="$(get_platform)" # e.g. unknown-linux-gnu
arch="$(get_arch)"         # e.g. x86_64
filename="anchor-${version}-${arch}-${platform}"
url="https://github.com/solana-foundation/anchor/releases/download/v${version}/${filename}"

echo "Downloading Anchor $version from:"
echo "  $url"

mkdir -p "$install_path/bin"
curl -sSL "$url" -o "$install_path/bin/anchor"
chmod +x "$install_path/bin/anchor"
